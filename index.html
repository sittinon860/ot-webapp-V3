<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏≠‡∏õ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏•‡∏á / ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ (‡∏≠‡∏±‡∏õ‡πÄ‡∏Å‡∏£‡∏î)</title>
<style>
body {
  font-family: sans-serif;
  text-align: center;
  background: #121212;
  color: white;
}
input, button {
  margin: 5px;
  padding: 10px;
  border: none;
  border-radius: 5px;
  font-size: 16px;
}
button {
  background: #1db954;
  color: white;
  cursor: pointer;
}
button:hover { background: #17a24f; }

#playlist {
  max-width: 90%;
  margin: 15px auto;
  text-align: left;
  background: #1e1e1e;
  border-radius: 10px;
  padding: 10px;
  min-height: 50px;
}
.playlist-item {
  padding: 8px 10px;
  border-bottom: 1px solid #333;
  cursor: pointer;
  color: #ccc;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}
.playlist-item:hover { background: #333; color: white; }
.playlist-item.active {
  background: #1db954;
  color: white;
}
</style>
</head>
<body>

<h2>üéß ‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏≠‡∏õ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏•‡∏á / ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ üé∂</h2>

<input type="file" id="fileInput" accept="audio/*,video/*" multiple><br>

<input type="text" id="urlInput" placeholder="‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏û‡∏•‡∏á‡∏´‡∏£‡∏∑‡∏≠ YouTube" style="width:80%;">
<button id="loadUrlBtn">‡πÄ‡∏õ‡∏¥‡∏î</button>

<div id="songName" style="margin-top:10px;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏•‡πà‡∏ô</div>

<audio id="audioPlayer" controls style="display:none;width:90%;margin-top:15px;"></audio>
<video id="videoPlayer" controls playsinline style="display:none;" width="90%"></video>
<div id="youtubePlayer" style="display:none;"></div>

<h3>üìú ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏•‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ß‡πâ</h3>
<div id="playlist"></div>

<div style="margin-top:10px;">
  <button id="prevBtn">‚èÆÔ∏è</button>
  <button id="playBtn">‚ñ∂Ô∏è / ‚è∏Ô∏è</button>
  <button id="nextBtn">‚è≠Ô∏è</button>
  <button id="stopBtn">‚èπÔ∏è</button>
</div>

<script>
let files = [];
let currentIndex = 0;
const audio = document.getElementById('audioPlayer');
const video = document.getElementById('videoPlayer');
const youtube = document.getElementById('youtubePlayer');
const playlistDiv = document.getElementById('playlist');
const songName = document.getElementById('songName');

// --------------------------------------------------------
// Media Session API Functions (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Background Playback ‡πÅ‡∏•‡∏∞ Lock Screen Controls)
// --------------------------------------------------------
function updateMediaSession(title = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏•‡∏á', artist = '‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏≠‡∏õ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏•‡∏á') {
  if ('mediaSession' in navigator) {
    navigator.mediaSession.metadata = new MediaMetadata({
      title: title,
      artist: artist,
      album: '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏•‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß',
    });

    // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î Action Handlers ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ö‡∏ô Lock Screen / Notification
    navigator.mediaSession.setActionHandler('play', () => {
      document.getElementById('playBtn').click(); 
      // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô
      if (audio.style.display === 'block' && audio.paused === false) navigator.mediaSession.playbackState = 'playing';
      if (video.style.display === 'block' && video.paused === false) navigator.mediaSession.playbackState = 'playing';
    });

    navigator.mediaSession.setActionHandler('pause', () => {
      document.getElementById('playBtn').click();
      navigator.mediaSession.playbackState = 'paused';
    });

    // ‡∏õ‡∏∏‡πà‡∏°‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏û‡∏•‡∏á (Next Track)
    navigator.mediaSession.setActionHandler('nexttrack', document.getElementById('nextBtn').onclick);
    
    // ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏û‡∏•‡∏á (Previous Track)
    navigator.mediaSession.setActionHandler('previoustrack', document.getElementById('prevBtn').onclick);
    
    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô 'playing' ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ
    navigator.mediaSession.playbackState = 'playing'; 
  }
}

// --------------------------------------------------------
// Player Controls and Core Functions
// --------------------------------------------------------

// ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå
document.getElementById('fileInput').addEventListener('change', e => {
  files = Array.from(e.target.files);
  if (files.length > 0) {
    currentIndex = 0;
    renderPlaylist();
    playLocal();
  }
});

// ‡πÅ‡∏™‡∏î‡∏á Playlist
function renderPlaylist() {
  playlistDiv.innerHTML = '';
  if (files.length === 0) {
    playlistDiv.textContent = '‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏û‡∏•‡∏á‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£';
    return;
  }
  files.forEach((file, index) => {
    const div = document.createElement('div');
    div.textContent = `${index + 1}. ${file.name}`;
    div.classList.add('playlist-item');
    if (index === currentIndex) div.classList.add('active');
    div.onclick = () => {
      currentIndex = index;
      playLocal();
    };
    playlistDiv.appendChild(div);
  });
}

// ‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö .wav ‡πÅ‡∏•‡∏∞‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏≠‡∏∑‡πà‡∏ô‡πÜ)
function playLocal() {
  hideAllPlayers();
  const file = files[currentIndex];
  const url = URL.createObjectURL(file);
  const fileName = file.name;
  songName.textContent = `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏•‡πà‡∏ô: ${fileName}`;

  const type = file.type || '';
  let player = video; 

  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á (‡∏£‡∏ß‡∏° .wav)
  if (type.startsWith('audio') || 
      fileName.toLowerCase().endsWith('.wav') || 
      fileName.toLowerCase().endsWith('.mp3') || 
      fileName.toLowerCase().endsWith('.ogg')) {
    player = audio;
    video.style.display = 'none'; 
  } else {
    player = video;
    audio.style.display = 'none'; 
  }
  
  player.src = url;
  player.style.display = 'block';

  // ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÄ‡∏•‡πà‡∏ô‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Media Session
  player.play().then(() => {
    updateMediaSession(fileName, '‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á');
  }).catch(err => {
    console.error('‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ:', err);
    songName.textContent = `‚ö†Ô∏è ‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (Codec/Format ‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö): ${fileName}`;
    if ('mediaSession' in navigator) navigator.mediaSession.playbackState = 'paused';
  });

  renderPlaylist();
}

// ‡πÄ‡∏õ‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå
document.getElementById('loadUrlBtn').addEventListener('click', () => {
  const url = document.getElementById('urlInput').value.trim();
  if (!url) return;
  
  // ‡∏•‡πâ‡∏≤‡∏á Playlist ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏à‡∏≤‡∏Å URL
  files = []; 
  currentIndex = 0;
  renderPlaylist();

  hideAllPlayers();

  if (url.includes('youtube.com') || url.includes('youtu.be')) {
    songName.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏•‡πà‡∏ô‡∏à‡∏≤‡∏Å YouTube...';
    youtube.style.display = 'block';
    loadYouTube(url);
    updateMediaSession('YouTube Video', '‡∏≠‡∏≤‡∏à‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠');
  } else {
    songName.textContent = `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏•‡πà‡∏ô‡∏à‡∏≤‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå: ${url}`;
    let player = audio; 

    if (url.endsWith('.mp4') || url.endsWith('.mov') || url.includes('video')) {
      player = video;
    }
    
    player.src = url;
    player.style.display = 'block';
    
    player.play().then(() => {
      updateMediaSession(url.split('/').pop(), '‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å');
    }).catch(err => {
      console.error('‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ:', err);
      songName.textContent = '‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡πà‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏°‡∏µ‡πÄ‡∏î‡∏µ‡∏¢‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ';
      if ('mediaSession' in navigator) navigator.mediaSession.playbackState = 'paused';
    });
  }
});

function hideAllPlayers() {
  audio.style.display = 'none';
  video.style.display = 'none';
  youtube.style.display = 'none';
  audio.pause(); audio.currentTime = 0;
  video.pause(); video.currentTime = 0;
  youtube.innerHTML = ''; 
}

// ‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° Play/Pause
document.getElementById('playBtn').onclick = () => {
  let player = audio.style.display === 'block' ? audio : (video.style.display === 'block' ? video : null);

  if (player) {
    if (player.paused) {
      player.play().then(() => {
        if ('mediaSession' in navigator) navigator.mediaSession.playbackState = 'playing';
      });
    } else {
      player.pause();
      if ('mediaSession' in navigator) navigator.mediaSession.playbackState = 'paused';
    }
  } else if (youtube.style.display === 'block') {
    console.log("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ö‡∏ô YouTube Player ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á");
  }
};

document.getElementById('nextBtn').onclick = () => {
  if (files.length > 0) {
    currentIndex = (currentIndex + 1) % files.length;
    playLocal();
  }
};
document.getElementById('prevBtn').onclick = () => {
  if (files.length > 0) {
    currentIndex = (currentIndex - 1 + files.length) % files.length;
    playLocal();
  }
};
document.getElementById('stopBtn').onclick = () => {
  audio.pause(); audio.currentTime = 0;
  video.pause(); video.currentTime = 0;
  if ('mediaSession' in navigator) navigator.mediaSession.playbackState = 'paused';
};

// YouTube Loader
function loadYouTube(url) {
  // ‡∏î‡∏∂‡∏á Video ID ‡∏à‡∏≤‡∏Å URL
  let videoId = '';
  try {
    const urlObj = new URL(url);
    videoId = urlObj.searchParams.get('v');
    if (!videoId && url.includes('youtu.be/')) {
        videoId = url.split('youtu.be/')[1].split('?')[0];
    }
  } catch (e) {
    console.error("Invalid URL", e);
  }

  if (videoId) {
      youtube.innerHTML = `<iframe width="90%" height="315"
        src="https://www.youtube.com/embed/${videoId}?autoplay=1"
        frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
  } else {
      songName.textContent = '‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö Video ID ‡∏Ç‡∏≠‡∏á YouTube';
  }
}

// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Playlists ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏•‡∏á‡πÄ‡∏•‡πà‡∏ô‡∏à‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)
audio.addEventListener('ended', document.getElementById('nextBtn').onclick);
video.addEventListener('ended', document.getElementById('nextBtn').onclick);

// ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Media Session ‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô
if ('mediaSession' in navigator) {
    navigator.mediaSession.playbackState = 'none';
}
</script>

</body>
</html>
