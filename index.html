<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ทดลองบันทึก OT</title>
<style>
body { font-family: Arial, sans-serif; padding:20px; background:#f0f4ff;}
h2{ text-align:center; color:#0d47a1;}
table{ width:100%; border-collapse: collapse; margin-top:10px;}
th, td{ border:1px solid #1976d2; padding:5px; text-align:center;}
input[type="number"]{ width:80px; }
button{ padding:5px 10px; margin:5px; cursor:pointer; border:none; border-radius:5px; background:#1976d2; color:white;}
button:hover{ background:#0d47a1;}
</style>
</head>
<body>

<h2>ทดลองบันทึก OT (เวอร์ชั่นทดลอง)</h2>

<div>
<button id="downloadBackup">ดาวน์โหลดสำรอง</button>
<input type="file" id="uploadBackup" accept=".json">
<button id="resetData">ล้างข้อมูล</button>
</div>

<table>
<thead>
<tr>
<th>วันที่</th><th>ชั่วโมง OT</th><th>หมายเหตุ</th>
</tr>
</thead>
<tbody>
<tr>
<td>21/10/2025</td>
<td><input type="number" min="0" max="12" step="0.5" id="otInput"></td>
<td id="noteCell"></td>
</tr>
</tbody>
</table>

<script>
const otInput = document.getElementById("otInput");
const noteCell = document.getElementById("noteCell");
const key = "testOTData";

// โหลดข้อมูลจาก LocalStorage
function loadData(){
    const saved = JSON.parse(localStorage.getItem(key)||'{}');
    if(saved.hours !== undefined){
        otInput.value = saved.hours;
        noteCell.textContent = saved.note || "";
    }
}
loadData();

// บันทึกข้อมูลอัตโนมัติ
otInput.addEventListener("input", ()=>{
    const hours = parseFloat(otInput.value)||0;
    const note = (hours>0 && hours<=3) ? "ตัดกลับ" : "";
    noteCell.textContent = note;
    localStorage.setItem(key, JSON.stringify({hours, note}));
});

// ดาวน์โหลดสำรอง
document.getElementById("downloadBackup").addEventListener("click", ()=>{
    const data = localStorage.getItem(key);
    if(!data){ alert("ไม่มีข้อมูลบันทึก"); return; }
    const blob = new Blob([data], {type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "OT_Backup.json";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
});

// โหลดคืนข้อมูลจากไฟล์
document.getElementById("uploadBackup").addEventListener("change", (e)=>{
    const file = e.target.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = function(evt){
        try{
            const json = JSON.parse(evt.target.result);
            localStorage.setItem(key, JSON.stringify(json));
            loadData();
            alert("โหลดข้อมูลสำเร็จ!");
        }catch(err){
            alert("ไฟล์ไม่ถูกต้อง");
        }
    };
    reader.readAsText(file);
});

// ล้างข้อมูล
document.getElementById("resetData").addEventListener("click", ()=>{
    if(confirm("คุณต้องการล้างข้อมูลใช่หรือไม่?")){
        localStorage.removeItem(key);
        otInput.value = "";
        noteCell.textContent = "";
    }
});
</script>

</body>
</html>
